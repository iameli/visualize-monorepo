<!DOCTYPE html>
<html>
  <head> </head>

  <body>
    <input id="repo" value="github/livepeer/livepeerjs" />
    <button>Do it!</button>
    <div id="display"></div>
    <script>
      function registerValidSW(swUrl) {
        navigator.serviceWorker
          .register(swUrl)
          .then(registration => {
            registration.onupdatefound = () => {
              const installingWorker = registration.installing;
              installingWorker.onstatechange = () => {
                if (installingWorker.state === "installed") {
                  if (navigator.serviceWorker.controller) {
                    // At this point, the old content will have been purged and
                    // the fresh content will have been added to the cache.
                    // It's the perfect time to display a "New content is
                    // available; please refresh." message in your web app.
                    console.log("New content is available; please refresh.");
                    window.location = window.location;
                  } else {
                    // At this point, everything has been precached.
                    // It's the perfect time to display a
                    // "Content is cached for offline use." message.
                    console.log("Content is cached for offline use.");
                  }
                }
              };
            };
          })
          .catch(error => {
            console.error("Error during service worker registration:", error);
          });
      }

      navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for (let registration of registrations) {
          registration.addEventListener("updatefound", () => {
            console.log("update found");
          });
          // console.log("found registration");
          // console.log("unregsitering");
          // registration.unregister();
          // return (window.location = window.location);
          // console.log("found a registered serviceworker");
        }
      });
      registerValidSW("/worker.js");

      document.querySelector("button").addEventListener("click", async () => {
        const res = await fetch(`${document.querySelector("#repo").value}.svg`);
        const text = await res.text();
        document.querySelector("#display").innerHTML = text;
      });
    </script>
  </body>
</html>
